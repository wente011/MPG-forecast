---
title: "Fuel Economy Forecast"
output: html_document
---

Ok, so. This may be a futile exercise. But, we just really need SOME idea of how MPGs have evolved for light, heavy, and medium fleet vehicles over the past several years. I just need a BAU estimate for the fleet action plan. Of course, I will exponenitally decay this function such that the cars do not get supremely efficient. However, what we currrently have is not sufficient in my view, because it is not founded in anything. We have absolutely no idea how much more efficienct vehicles might actually get in the aggregate. 

By forecasting with aggregate statistics, we avoid violating simple rules for statistical inference. 


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidypredict)
library(tidyquant)
library(tidyverse)
library(magrittr)
library(curl)

library(gridExtra)
library(scales)
library(ggthemes)

```

## R data loading and manip

```{r ggtheme}
theme_Publication <- function(base_size=14, base_family="helvetica") {
      library(grid)
      library(ggthemes)
      (theme_foundation(base_size=base_size, base_family=base_family)
       + theme(plot.title = element_text(face = "bold",
                                         size = rel(1.2), hjust = 0.5),
               text = element_text(),
               panel.background = element_rect(colour = NA),
               plot.background = element_rect(colour = NA),
               panel.border = element_rect(colour = NA),
               axis.title = element_text(face = "bold",size = rel(1)),
               axis.title.y = element_text(angle=90,vjust =2),
               axis.title.x = element_text(vjust = -0.2),
               axis.text = element_text(), 
               axis.line = element_line(colour="black"),
               axis.ticks = element_line(),
               panel.grid.major = element_line(colour="#f0f0f0"),
               panel.grid.minor = element_blank(),
               legend.key = element_rect(colour = NA),
               legend.position = "bottom",
               legend.direction = "horizontal",
               legend.key.size= unit(0.2, "cm"),
               legend.margin = unit(0, "cm"),
               legend.title = element_text(face="italic"),
               plot.margin=unit(c(10,5,5,5),"mm"),
               strip.background=element_rect(colour="#f0f0f0",fill="#f0f0f0"),
               strip.text = element_text(face="bold")
          ))
      
}

scale_fill_Publication <- function(...){
      library(scales)
      discrete_scale("fill","Publication",manual_pal(values = c("#386cb0","#fdb462","#7fc97f","#ef3b2c","#662506","#a6cee3","#fb9a99","#984ea3","#ffff33")), ...)

}

scale_colour_Publication <- function(...){
      library(scales)
      discrete_scale("colour","Publication",manual_pal(values = c("#386cb0","#fdb462","#7fc97f","#ef3b2c","#662506","#a6cee3","#fb9a99","#984ea3","#ffff33")), ...)

}
```


```{r cars}
url<-"https://www.fueleconomy.gov/feg/epadata/vehicles.csv.zip"
tmp<-tempfile()
download.file(url,dest=tmp)
data<-read_csv(unz(tmp,"vehicles.csv"))
```

## summarizations
So, it looks like all of these vehilces are under 8,500 lbs. 

```{r}

facs<-c("VClass","year")   #the factor levels that I think I want to work with. 

vars<-c("city08U","cityA08U","comb08U","combA08U","highway08U","highwayA08U")

sums<-data %>% group_by(VClass,year) %>% summarise_at(vars,mean,na.rm=T) %>% ggplot(aes(x=year,y=highway08U,color=VClass)) + geom_point() + scale_fill_Publication() +theme_Publication()


```

