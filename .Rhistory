gg.metc<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"))  %>%
ggscatter(.,x = "YEAR", y = "mpg", add = "reg.line",size=2,alpha=0.1) + geom_point(aes(x=YEAR,y=mpg,color=Year)) +
stat_cor(label.x = 2000, label.y = 1.5) +
stat_regline_equation(label.x = 2000, label.y = 1.4) + geom_point(alpha=0.1) +
ggtitle("MPG trends by Year (METC Heavy Fleet)") + theme_economist() + scale_colour_economist() + scale_y_continuous(breaks=seq(0,3,0.1)) + scale_x_continuous(breaks=seq(1990,2019,1.4))
gg.metc
gg.metc<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"))  %>%
ggscatter(.,x = "YEAR", y = "mpg", add = "reg.line",size=2,alpha=0.1) + geom_point(aes(x=YEAR,y=mpg,color=as.factor(Year))) +
stat_cor(label.x = 2000, label.y = 1.5) +
stat_regline_equation(label.x = 2000, label.y = 1.4) + geom_point(alpha=0.1) +
ggtitle("MPG trends by Year (METC Heavy Fleet)") + theme_economist() + scale_colour_economist() + scale_y_continuous(breaks=seq(0,3,0.1)) + scale_x_continuous(breaks=seq(1990,2019,1.4))
gg.metc
gg.metc
metc<-read_excel("metcfleet.xlsx") %>% mutate(mpg=`Total Raw Gallons`/`MILES_TRAVELED`) %>% mutate(Year=year(FromDate)) %>% filter(Year==2018)
gg.metc<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"))  %>%
ggscatter(.,x = "YEAR", y = "mpg", add = "reg.line",size=2,alpha=0.1) + geom_point(aes(x=YEAR,y=mpg,color=as.factor(Year))) +
stat_cor(label.x = 2000, label.y = 1.5) +
stat_regline_equation(label.x = 2000, label.y = 1.4) + geom_point(alpha=0.1) +
ggtitle("MPG trends by Year (METC Heavy Fleet)") + theme_economist() + scale_colour_economist() + scale_y_continuous(breaks=seq(0,3,0.1)) + scale_x_continuous(breaks=seq(1990,2019,1.4))
gg.metc
gg.metc
metc$OWNING_DEPT
gg.metc<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"))  %>%
ggscatter(.,x = "YEAR", y = "mpg", add = "reg.line",size=2,alpha=0.1) + geom_point(aes(x=YEAR,y=mpg,color=USING_DEPT_NO_DESC)) +
stat_cor(label.x = 2000, label.y = 1.5) +
stat_regline_equation(label.x = 2000, label.y = 1.4) + geom_point(alpha=0.1) +
ggtitle("MPG trends by Year (METC Heavy Fleet)") + theme_economist() + scale_colour_economist() + scale_y_continuous(breaks=seq(0,3,0.1)) + scale_x_continuous(breaks=seq(1990,2019,1.4))
gg.metc
gg.metc
gg.metc<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"))  %>%
ggscatter(.,x = "YEAR", y = "mpg", add = "reg.line",size=2,alpha=0.1) + geom_point(aes(x=YEAR,y=mpg,color=USING_DEPT_NO_DESC)) +
stat_cor(label.x = 2000, label.y = 1.5) +
stat_regline_equation(label.x = 2000, label.y = 1.4) + geom_point(alpha=0.1) +
ggtitle("MPG trends by Year (METC Heavy Fleet)") + theme_economist() + scale_colour_economist() + scale_y_continuous(breaks=seq(0,3,0.1)) + scale_x_continuous(breaks=seq(1990,2019,1))
gg.metc
gg.metc
gg.metc<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>%
ggscatter(.,x = "YEAR", y = "mpg", add = "reg.line",size=2,alpha=0.1) + geom_point(aes(x=YEAR,y=mpg,color=USING_DEPT_NO_DESC)) +
stat_cor(label.x = 2000, label.y = 1.5) +
stat_regline_equation(label.x = 2000, label.y = 1.4) + geom_point(alpha=0.1) +
ggtitle("MPG trends by Year (METC Heavy Fleet)") + theme_economist() + scale_colour_economist() + scale_y_continuous(breaks=seq(0,3,0.1)) + scale_x_continuous(breaks=seq(1990,2019,1))
gg.metc
gg.metc
gg.metc<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>%
ggscatter(.,x = "YEAR", y = "mpg", add = "reg.line",size=2,alpha=0.1) + geom_point(aes(x=YEAR,y=mpg,color=USING_DEPT_NO_DESC)) +
stat_cor(label.x = 2000, label.y = 1.5) +
stat_regline_equation(label.x = 2000, label.y = 1.4) + geom_point(alpha=0.1) +
ggtitle("MPG trends by Year (METC Heavy Fleet)") + theme_economist() + scale_colour_tableau() + scale_y_continuous(breaks=seq(0,3,0.1)) + scale_x_continuous(breaks=seq(1990,2019,1))
gg.metc
gg.metc
metc
gg.metc<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>%
ggscatter(.,x = "YEAR", y = "mpg", add = "reg.line",size=2,alpha=0.1) + geom_point(aes(x=YEAR,y=mpg,color=USING_DEPT_NO_DESC,text=paste0(MAKE,"-",MODEL))) +
stat_cor(label.x = 2000, label.y = 1.5) +
stat_regline_equation(label.x = 2000, label.y = 1.4) + geom_point(alpha=0.1) +
ggtitle("MPG trends by Year (METC Heavy Fleet)") + theme_economist() + scale_colour_tableau() + scale_y_continuous(breaks=seq(0,3,0.1)) + scale_x_continuous(breaks=seq(1990,2019,1))
gg.metc %>% ggplotly()
gg.metc<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>%
ggscatter(.,x = "YEAR", y = "mpg", add = "reg.line",size=2,alpha=0.1) + geom_point(aes(x=YEAR,y=mpg,color=USING_DEPT_NO_DESC,text=paste0(MAKE,"-",MODEL))) +
stat_cor(label.x = 2000, label.y = 1.5) +
stat_regline_equation(label.x = 2000, label.y = 1.4) + geom_point(alpha=0.1) +
ggtitle("MPG trends by Year (METC Heavy Fleet)") +# theme_economist() + scale_colour_tableau() + scale_y_continuous(breaks=seq(0,3,0.1)) + scale_x_continuous(breaks=seq(1990,2019,1))
gg.metc %>% ggplotly()
gg.metc<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>%
ggscatter(.,x = "YEAR", y = "mpg", add = "reg.line",size=2,alpha=0.1) + geom_point(aes(x=YEAR,y=mpg,color=USING_DEPT_NO_DESC,text=paste0(MAKE,"-",MODEL))) +
stat_cor(label.x = 2000, label.y = 1.5) +
stat_regline_equation(label.x = 2000, label.y = 1.4) + geom_point(alpha=0.1) +
ggtitle("MPG trends by Year (METC Heavy Fleet)") # + # theme_economist() + scale_colour_tableau() + scale_y_continuous(breaks=seq(0,3,0.1)) + scale_x_continuous(breaks=seq(1990,2019,1))
gg.metc %>% ggplotly()
gg.metc<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>%
ggscatter(.,x = "YEAR", y = "mpg", add = "reg.line",size=2,alpha=0.1) + geom_point(aes(x=YEAR,y=mpg,color=USING_DEPT_NO_DESC,text=paste0(MAKE,"-",MODEL))) +
stat_cor(label.x = 2000, label.y = 1.5) +
stat_regline_equation(label.x = 2000, label.y = 1.4) + geom_point(alpha=0.1) +
ggtitle("MPG trends by Year (METC Heavy Fleet)")  +  theme_economist() + scale_colour_tableau() + scale_y_continuous(breaks=seq(0,3,0.1)) + scale_x_continuous(breaks=seq(1990,2019,1))
gg.metc
gg.metc
gg.metc<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>%
ggscatter(.,x = "YEAR", y = "mpg", add = "reg.line",size=2,alpha=0.1) + geom_point(aes(x=YEAR,y=mpg,color=USING_DEPT_NO_DESC,text=paste0(MAKE,"-",MODEL))) +
stat_cor(label.x = 2000, label.y = 1.5) +
stat_regline_equation(label.x = 2000, label.y = 1.4) + geom_point(alpha=0.1) +
ggtitle("MPG trends by Model Year (METC Heavy Fleet)")  +  theme_economist() + scale_colour_tableau() + scale_y_continuous(breaks=seq(0,3,0.1)) + scale_x_continuous(breaks=seq(1990,2019,1))
ggmetc
gg.metc
gg.metc<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>%
ggscatter(.,x = "YEAR", y = "mpg", add = "reg.line",size=2,alpha=0.1) + geom_point(aes(x=YEAR,y=mpg,color=USING_DEPT_NO_DESC,text=paste0(MAKE,"-",MODEL))) +
stat_cor(label.x = 1990, label.y = .9) +
stat_regline_equation(label.x = 1990, label.y = 1) + geom_point(alpha=0.1) +
ggtitle("MPG trends by Model Year (METC Heavy Fleet)")  +  theme_economist() + scale_colour_tableau() + scale_y_continuous(breaks=seq(0,1,0.05)) + scale_x_continuous(breaks=seq(1990,2019,1))
gg.metc
gg.metc
metc$MODEL
gg.metc<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>%
ggscatter(.,x = "YEAR", y = "mpg", add = "reg.line",size=2,alpha=0.1) + geom_point(aes(x=YEAR,y=mpg,color=USING_DEPT_NO_DESC,text=MODEL))) +
gg.metc<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>%
ggscatter(.,x = "YEAR", y = "mpg", add = "reg.line",size=2,alpha=0.1) + geom_point(aes(x=YEAR,y=mpg,color=USING_DEPT_NO_DESC,text=MODEL)) +
stat_cor(label.x = 1990, label.y = .9) +
stat_regline_equation(label.x = 1990, label.y = 1) + geom_point(alpha=0.1) +
ggtitle("MPG trends by Model Year (METC Heavy Fleet)")  +  theme_economist() + scale_colour_tableau() + scale_y_continuous(breaks=seq(0,1,0.05)) + scale_x_continuous(breaks=seq(1990,2019,1))
gg.metc
gg.metc
gg.metc<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>% ggplot(aes(x=YEAR,y=mpg,color=USING_DEPT_NO_DESC)) %>% geom_smooth(method="lm",se=T)
gg.metc2<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>% ggplot(aes(x=YEAR,y=mpg,color=USING_DEPT_NO_DESC))+ geom_smooth(method="lm",se=T)
gg.metc2
gg.metc2<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>% ggplot(aes(x=YEAR,y=mpg))+ geom_smooth(method="lm",se=T) + geom_point(aes(color=USING_DEPT_NO_DESC,x=YEAR,y=mpg)
)
gg.metc2
gg.metc2<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>% ggplot(aes(x=YEAR,y=mpg))+ geom_smooth(method="lm",se=T) + geom_point(aes(color=USING_DEPT_NO_DESC,x=YEAR,y=mpg,text=MODEL)) + scale_x_continuous(breaks=seq(1990,2019,1))
gg.metc2<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>% ggplot(aes(x=YEAR,y=mpg))+ geom_smooth(method="lm",se=T) + geom_point(aes(color=USING_DEPT_NO_DESC,x=YEAR,y=mpg,text=MODEL)) + scale_x_continuous(breaks=seq(1990,2019,1)) + scale_y_continuous(breaks=seq(0,1,0.05))
gg.metc2
gg.metc2<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>% ggplot(aes(x=YEAR,y=mpg,text=MODEL))+ geom_smooth(method="lm",se=T) + geom_point(aes(color=USING_DEPT_NO_DESC,x=YEAR,y=mpg)) + scale_x_continuous(breaks=seq(1990,2019,1)) + scale_y_continuous(breaks=seq(0,1,0.05))
gg.metc2
gg.metc2
gg.metc2<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>% ggplot(aes(x=YEAR,y=mpg,text=MODEL))+ geom_smooth(method="lm",se=T) #+ geom_point(aes(color=USING_DEPT_NO_DESC,x=YEAR,y=mpg)) + scale_x_continuous(breaks=seq(1990,2019,1)) + scale_y_continuous(breaks=seq(0,1,0.05))
gg.metc2
gg.metc2
metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))
gg.metc2<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>% ggplot(aes(x=YEAR,y=mpg))+ geom_smooth(method="lm",se=T) #+ geom_point(aes(color=USING_DEPT_NO_DESC,x=YEAR,y=mpg)) + scale_x_continuous(breaks=seq(1990,2019,1)) + scale_y_continuous(breaks=seq(0,1,0.05))
gg.metc2
gg.metc2
gg.metc2<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>% ggplot(aes(x=YEAR,y=mpg))+ geom_point() +  geom_smooth(method="lm",se=T) #+ geom_point(aes(color=USING_DEPT_NO_DESC,x=YEAR,y=mpg)) + scale_x_continuous(breaks=seq(1990,2019,1)) + scale_y_continuous(breaks=seq(0,1,0.05))
gg.metc2
gg.metc2
gg.metc2<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>% ggplot(aes(x=YEAR,y=mpg))+ geom_point(aes(color=USING_DEPT_NO_DESC,x=YEAR,y=mpg)) + geom_smooth(method="lm",se=T)  + scale_x_continuous(breaks=seq(1990,2019,1)) + scale_y_continuous(breaks=seq(0,1,0.05))
gg.metc2
gg.metc2
metc$MODEL
gg.metc2<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>% ggplot(aes(x=YEAR,y=mpg,text=MODEL))+ geom_point(aes(color=USING_DEPT_NO_DESC,x=YEAR,y=mpg)) + geom_smooth(method="lm",se=T)  + scale_x_continuous(breaks=seq(1990,2019,1)) + scale_y_continuous(breaks=seq(0,1,0.05))
gg.metc2
gg.metc2
gg.metc2<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>% ggplot(aes(x=YEAR,y=mpg))+ geom_point(aes(color=USING_DEPT_NO_DESC,x=YEAR,y=mpg)) + geom_smooth(method="lm",se=T)  + scale_x_continuous(breaks=seq(1990,2019,1)) + scale_y_continuous(breaks=seq(0,1,0.05))
gg.metc2<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>% ggplot(aes(x=YEAR,y=mpg))+ geom_point(aes(color=USING_DEPT_NO_DESC,x=YEAR,y=mpg,text=MODEL)) + geom_smooth(method="lm",se=T)  + scale_x_continuous(breaks=seq(1990,2019,1)) + scale_y_continuous(breaks=seq(0,1,0.05))
gg.metc2
gg.metc2
gg.metc2<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>% ggplot(aes(x=YEAR,y=mpg))+ geom_point(aes(color=USING_DEPT_NO_DESC,x=YEAR,y=mpg,label=MODEL)) + geom_smooth(method="lm",se=T)  + scale_x_continuous(breaks=seq(1990,2019,1)) + scale_y_continuous(breaks=seq(0,1,0.05))
gg.metc2
MODEL
gg.metc2<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>% ggplot(aes(x=YEAR,y=mpg,label=MODEL))+ geom_point(aes(color=USING_DEPT_NO_DESC,x=YEAR,y=mpg,label=MODEL)) + geom_smooth(method="lm",se=T)  + scale_x_continuous(breaks=seq(1990,2019,1)) + scale_y_continuous(breaks=seq(0,1,0.05))
gg.metc2
gg.metc2 %>% ggplotly()
gg.metc2 %>% ggplotly() %>% htmlwidgets::saveWidget(as_widget(.), "metcMPG.html")
gg.pmetc<-gg.metc2 %>% ggplotly()
htmlwidgets::saveWidget(as_widget(gg.pmetc), "metcMPG.html")
gg.metc2<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>% ggplot(aes(x=YEAR,y=mpg,label=MODEL))+ geom_point(aes(color=USING_DEPT_NO_DESC)) + geom_smooth(method="lm",se=T)  + scale_x_continuous(breaks=seq(1990,2019,1)) + scale_y_continuous(breaks=seq(0,1,0.05))
gg.pmetc<-gg.metc2 %>% ggplotly()
htmlwidgets::saveWidget(as_widget(gg.pmetc), "metcMPG.html")
gg.metc2<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>% ggplot(aes(x=YEAR,y=mpg,label=MODEL))+ geom_point(aes(color=USING_DEPT_NO_DESC)) + geom_smooth(method="lm",se=T)  + scale_x_continuous(breaks=seq(1990,2019,1),"Model Year") + scale_y_continuous(breaks=seq(0,1,0.05),"MPG")
gg.pmetc<-gg.metc2 %>% ggplotly()
htmlwidgets::saveWidget(as_widget(gg.pmetc), "metcMPG.html")
gg.metc2<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>% ggplot(aes(x=YEAR,y=mpg,label=MODEL))+ geom_point(aes(color=USING_DEPT_NO_DESC)) + geom_smooth(method="lm",se=T)  + scale_x_continuous(breaks=seq(1990,2019,1),"Model Year") + scale_y_continuous(breaks=seq(0,1,0.05),"MPG")
gg.pmetc<-gg.metc2 %>% ggplotly()
gg.metc2<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>% ggplot(aes(x=YEAR,y=mpg,label=MODEL))+ geom_point(aes(color=USING_DEPT_NO_DESC)) + geom_smooth(method="lm",se=T)  + scale_x_continuous(breaks=seq(1990,2019,1),"Model Year") + scale_y_continuous(breaks=seq(0,1,0.05),"MPG")
gg.metc2<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>% ggplot(aes(x=YEAR,y=mpg,label=MODEL))+ geom_point(aes(color=USING_DEPT_NO_DESC)) + geom_smooth(method="lm",se=T)  + scale_x_continuous(breaks=seq(1990,2019,1),"Model Year") + scale_y_continuous(breaks=seq(0,1,0.05),"MPG")
gg.pmetc<-gg.metc2 %>% ggplotly()
gg.pmetc<-gg.metc2 %>% ggplotly()
gg.pmetc
htmlwidgets::saveWidget(as_widget(gg.pmetc), "metcMPG.html")
knitr::opts_chunk$set(echo = TRUE)
library(tidypredict)
library(readxl)
library(tidyquant)
library(tidyverse)
library(ggpubr)
library(magrittr)
library(curl)
library(gridExtra)
library(scales)
library(readxl)
library(plotly)
library(ggthemes)
library(forecast)
metc<-read_excel("metcfleet.xlsx") %>% mutate(mpg=`Total Raw Gallons`/`MILES_TRAVELED`) %>% mutate(Year=year(FromDate)) %>% filter(Year==2018)
metc
summary(metc\)
summary(metc)
gg.metc<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>%
ggscatter(.,x = "YEAR", y = "mpg", add = "reg.line",size=2,alpha=0.1) + geom_point(aes(x=YEAR,y=mpg,color=USING_DEPT_NO_DESC,text=MODEL)) +
stat_cor(label.x = 1990, label.y = .9) +
stat_regline_equation(label.x = 1990, label.y = 1) + geom_point(alpha=0.1) +
ggtitle("MPG trends by Model Year (METC Heavy Fleet)")  +  theme_economist() + scale_colour_tableau() + scale_y_continuous(breaks=seq(0,1,0.05)) + scale_x_continuous(breaks=seq(1990,2019,1))
gg.metc
metc
metc<-read_excel("metcfleet.xlsx") %>% mutate(mpg=`Total Raw Gallons`/MILES_TRAVELED) %>% mutate(Year=year(FromDate)) %>% filter(Year==2018)
metc
summary(metc)
metc<-read_excel("metcfleet.xlsx")
metc
metc<-read_excel("metcfleet.xlsx")
summray(metc)
summary(metc)
metc<-read_excel("metcfleet.xlsx") %>% mutate(Year=year(FromDate)) %>% filter(Year==2018)
metc<-read_excel("metcfleet.xlsx") %>% mutate(mpg=MILES_TRAVELED/`Total Raw Gallons`) %>% mutate(Year=year(FromDate)) %>% filter(Year==2018)
gg.metc<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>%
ggscatter(.,x = "YEAR", y = "mpg", add = "reg.line",size=2,alpha=0.1) + geom_point(aes(x=YEAR,y=mpg,color=USING_DEPT_NO_DESC,text=MODEL)) +
stat_cor(label.x = 1990, label.y = .9) +
stat_regline_equation(label.x = 1990, label.y = 1) + geom_point(alpha=0.1) +
ggtitle("MPG trends by Model Year (METC Heavy Fleet)")  +  theme_economist() + scale_colour_tableau() + scale_y_continuous(breaks=seq(0,1,0.05)) + scale_x_continuous(breaks=seq(1990,2019,1))
gg.metc
gg.metc<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>%
ggscatter(.,x = "YEAR", y = "mpg", add = "reg.line",size=2,alpha=0.1) + geom_point(aes(x=YEAR,y=mpg,color=USING_DEPT_NO_DESC,text=MODEL)) +
stat_cor(label.x = 1990, label.y = .9) +
stat_regline_equation(label.x = 1990, label.y = 1) + geom_point(alpha=0.1) +
ggtitle("MPG trends by Model Year (METC Heavy Fleet)")  +  theme_economist() + scale_colour_tableau() #+     scale_y_continuous(breaks=seq(0,1,0.05)) + scale_x_continuous(breaks=seq(1990,2019,1))
gg.metc
gg.metc<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>%
ggscatter(.,x = "YEAR", y = "mpg", add = "reg.line",size=2,alpha=0.1) + geom_point(aes(x=YEAR,y=mpg,color=USING_DEPT_NO_DESC,text=MODEL)) +
stat_cor(label.x = 1990, label.y = 10) +
stat_regline_equation(label.x = 1990, label.y = 11) + geom_point(alpha=0.1) +
ggtitle("MPG trends by Model Year (METC Heavy Fleet)")  +  theme_economist() + scale_colour_tableau() #+     scale_y_continuous(breaks=seq(0,1,0.05)) + scale_x_continuous(breaks=seq(1990,2019,1))
gg.metc
gg.metc<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>%
ggscatter(.,x = "YEAR", y = "mpg", add = "reg.line",size=2,alpha=0.1) + geom_point(aes(x=YEAR,y=mpg,color=USING_DEPT_NO_DESC,text=MODEL)) +
stat_cor(label.x = 1990, label.y = 10) +
stat_regline_equation(label.x = 1990, label.y = 11) + geom_point(alpha=0.1) +
ggtitle("MPG trends by Model Year (METC Heavy Fleet)")  +  theme_economist() + scale_colour_tableau() +     scale_y_continuous(breaks=seq(0,12.5,2)) + scale_x_continuous(breaks=seq(1990,2019,1))
gg.metc
gg.metc<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS"))  %>%
ggscatter(.,x = "YEAR", y = "mpg", add = "reg.line",size=2,alpha=0.1) + geom_point(aes(x=YEAR,y=mpg,color=USING_DEPT_NO_DESC,text=MODEL)) +
stat_cor(label.x = 1990, label.y = 10) +
stat_regline_equation(label.x = 1990, label.y = 11) + geom_point(alpha=0.1) +
ggtitle("MPG trends by Model Year (METC Heavy Fleet)")  +  theme_economist() + scale_colour_tableau() +     scale_y_continuous("MPG",breaks=seq(0,12.5,2)) + scale_x_continuous(breaks=seq(1990,2019,1))
gg.metc
gg.metc
metc %>% group_by(USING_DEPT_NO_DESC) %>% nest()
metc
mods<-metc %>% group_by(USING_DEPT_NO_DESC) %>% nest()
mods
mods<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS") %>% group_by(USING_DEPT_NO_DESC) %>% nest()
mods
_)
mods<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS")) %>% group_by(USING_DEPT_NO_DESC) %>% nest()
mods
names(metc)
############ METC models
hv_mod<-function(df){
fit<-lm(mpg~year,data=df)
}
hv_mod
mods<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS")) %>% group_by(USING_DEPT_NO_DESC) %>% nest() %>% mutate(lms=map(data,hv_mod))
############ METC models
hv_mod<-function(df){
fit<-lm(mpg~Year,data=df)
}
mods<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS")) %>% group_by(USING_DEPT_NO_DESC) %>% nest() %>% mutate(lms=map(data,hv_mod))
mods
mods$lms
metc<-read_excel("metcfleet.xlsx") %>% mutate(mpg=MILES_TRAVELED/`Total Raw Gallons`) %>% mutate(Year=year(FromDate)) %>% filter(Year==2018)
############ METC models
hv_mod<-function(df){
fit<-lm(mpg~Year,data=df)
}
mods<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS")) %>% group_by(USING_DEPT_NO_DESC) %>% nest() %>% mutate(lms=map(data,hv_mod))
mods$lms[[1]]
mods$lms[[2]]
mods$lms[[3]]
names(metc)
metc$YEAR
############ METC models
hv_mod<-function(df){
fit<-lm(mpg~YEAR,data=df)
}
mods<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS")) %>% group_by(USING_DEPT_NO_DESC) %>% nest() %>% mutate(lms=map(data,hv_mod))
mods
mods[[1]]
mods$lms
library(tidypredict)
knitr::opts_chunk$set(echo = TRUE)
library(tidypredict)
library(readxl)
library(tidyquant)
library(tidyverse)
library(ggpubr)
library(magrittr)
library(curl)
library(tidypredict)
library(gridExtra)
library(scales)
library(readxl)
library(plotly)
library(ggthemes)
library(forecast)
mods<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS")) %>% group_by(USING_DEPT_NO_DESC) %>% nest() %>% mutate(lms=map(data,hv_mod)) %>% mutate(tidylms=map(lms,tidy))
mods
mods$tidylms
add_predictions(mods$lms)
library(broom)
add_predictions(mods$lms)
library(broom)
library(modelr)
library(tidyverse)
add_predictions(mods$lms)
add_predictions(mods$lms[[1]])
add_predictions(mods$lms[[1]],data=mods$data[[1]])
mods
knitr::opts_chunk$set(echo = TRUE)
library(tidypredict)
library(readxl)
library(tidyquant)
library(tidyverse)
library(modelr)
library(ggpubr)
library(magrittr)
library(curl)
library(tidypredict)
library(gridExtra)
library(scales)
library(readxl)
library(plotly)
library(ggthemes)
library(forecast)
mods<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS")) %>% group_by(USING_DEPT_NO_DESC) %>% nest() %>% mutate(lms=map(data,hv_mod)) %>% mutate(tidylms=map(lms,tidy)) %>% mutate(data=map2(lms,data,add_predictions))
add_predictions()
mods<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS")) %>% group_by(USING_DEPT_NO_DESC) %>% nest() %>% mutate(lms=map(data,hv_mod)) %>% mutate(tidylms=map(lms,tidy)) %>% mutate(data=map2(.x=lms,.y=data,.f=add_predictions))
mods<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS")) %>% group_by(USING_DEPT_NO_DESC) %>% nest() %>% mutate(lms=map(data,hv_mod)) %>% mutate(tidylms=map(lms,tidy)) %>% mutate(data=map2(.x=lms,.y=data,.f=modelr::add_predictions))
mods
mods
mods<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS")) %>% group_by(USING_DEPT_NO_DESC) %>% nest() %>% mutate(lms=map(data,hv_mod)) %>% mutate(tidylms=map(lms,tidy)) %>% mutate(data2=map2(.x=lms,.y=data,.f=modelr::add_predictions))
library("forecast", lib.loc="~/R/R-3.6.1/library")
detach("package:forecast", unload=TRUE)
mods<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS")) %>% group_by(USING_DEPT_NO_DESC) %>% nest() %>% mutate(lms=map(data,hv_mod)) %>% mutate(tidylms=map(lms,tidy)) %>% mutate(data2=map2(.x=lms,.y=data,.f=modelr::add_predictions))
add_predictions(data=.x,model=.y,var="pred")
add_preds2<-function(.x,.y){
add_predictions(data=.x,model=.y,var="pred")
}
mods<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS")) %>% group_by(USING_DEPT_NO_DESC) %>% nest() %>% mutate(lms=map(data,hv_mod)) %>% mutate(tidylms=map(lms,tidy)) %>% mutate(data2=map2(.x=lms,.y=data,.f=add_preds2))
add_preds2<-function(.x,.y){
add_predictions(data=.x,model=.y,var="pred")
}
mods<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS")) %>% group_by(USING_DEPT_NO_DESC) %>% nest() %>% mutate(lms=map(data,hv_mod)) %>% mutate(tidylms=map(lms,tidy)) %>% mutate(data2=map2(.x=lms,.y=data,add_preds2))
mods<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS")) %>% group_by(USING_DEPT_NO_DESC) %>% nest() %>% mutate(lms=map(data,hv_mod)) %>% mutate(tidylms=map(lms,tidy)) %>% mutate(data=map2(.x=lms,.y=data,add_preds2))
mods<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS")) %>% group_by(USING_DEPT_NO_DESC) %>% nest() %>% mutate(lms=map(data,hv_mod)) %>% mutate(tidylms=map(lms,tidy)) #%>% mutate(data=map2(.x=lms,.y=data,add_preds2))
mods<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS")) %>% group_by(USING_DEPT_NO_DESC) %>% nest() %>% mutate(lms=map(data,hv_mod)) %>% mutate(tidylms=map(lms,tidy)) %>% mutate(data=pmap(.x=lms,.y=data,add_preds2))
mods<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS")) %>% group_by(USING_DEPT_NO_DESC) %>% nest() %>% mutate(lms=map(data,hv_mod)) %>% mutate(tidylms=map(lms,tidy)) %>% mutate(data=pmap(.x=lms,.y=data,.f=add_preds2))
map2(mods$data,mods$lms,add_preds2)
res<-map2(mods$data,mods$lms,add_preds2)
res
res[[1]]$pred
mods<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS")) %>% group_by(USING_DEPT_NO_DESC) %>% nest() %>% mutate(lms=map(data,hv_mod)) %>% mutate(tidylms=map(lms,tidy)) %>% mutate(data=map2(.x=lms,                                                                                                                                                                                                                                                        .y=data,                                                                                                                                                                                                                                                      .f=add_preds2))
mods<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS")) %>% group_by(USING_DEPT_NO_DESC) %>% nest() %>% mutate(lms=map(data,hv_mod)) %>% mutate(tidylms=map(lms,tidy)) %>% map2(data,mods,add_preds2)
res<-map2(mods$data,mods$lms,add_preds2)
res<-map2(mods$data,mods$lms,add_preds2) %>% bind_rows()
res
gg.metc2<-res %>% ggplot(aes(x=YEAR,y=mpg,color=USING_DEPT_NO_DESC)) + geom_point()  + geom_line(aes(x=YEAR,y=pred,color=USING_DEPT_NO_DESC))
gg.metc
gg.metc2
res$USING_DEPT
mods<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS")) %>% group_by(USING_DEPT_NO_DESC) %>% nest() %>% mutate(lms=map(data,hv_mod)) %>% mutate(tidylms=map(lms,tidy)) %>% ungroup()
mods
res<-map2(mods$data,mods$lms,add_preds2)
res[[1]]
res[[2]]
res[[3]]
mods<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS")) %>% group_by(USING_DEPT_NO_DESC) %>% nest() %>% mutate(lms=map(data,hv_mod)) %>% mutate(tidylms=map(lms,tidy)) %>%
ns<-list(mods$USING_DEPT_NO_DESC)
ns<-list(mods$USING_DEPT_NO_DESC)
ns
ns<-map(mods$USING_DEPT_NO_DESC,list)
ns
res<-map2(mods$data,mods$lms,add_preds2) %>% map(.,mutate(USING_DEPT_NO_DESC=rep(ns,length(.))))
res
ns<-map(mods$USING_DEPT_NO_DESC,list)
ns
res<-map2(mods$data,mods$lms,add_preds2) %>% nest()
res
mods<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS")) %>% group_by(USING_DEPT_NO_DESC) %>% nest() %>% mutate(lms=map(data,hv_mod)) %>% mutate(tidylms=map(lms,tidy))
mods
mods.pr<-mods %>% group_by(USING_DEPT_NO_DESC) %>% nest() %>% full_join(mods) %>% group_by(USING_DEPT_NO_DESC) %>% do(augment(.$lms[[1]],newdata=.$data[[1]]))
mods.pr<-mods %>% group_by(USING_DEPT_NO_DESC) %>% nest() %>% full_join(mods) %>% group_by(USING_DEPT_NO_DESC)
mods %>% group_by(USING_DEPT_NO_DESC)  %>% do(augment(.$lms[[1]],newdata=.$data[[1]]))
mods.pr<-mods %>% group_by(USING_DEPT_NO_DESC)  %>% do(augment(.$lms[[1]],newdata=.$data[[1]]))
mods.pr$.fitted
mods.pr
mods<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS")) %>% group_by(USING_DEPT_NO_DESC) %>% nest() %>% mutate(lms=map(data,hv_mod)) %>% mutate(tidylms=map(lms,tidy)) %>% group_by(USING_DEPT_NO_DESC)  %>% do(augment(.$lms[[1]],newdata=.$data[[1]]))
mods
mods<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS")) %>% group_by(USING_DEPT_NO_DESC) %>% nest() %>% mutate(lms=map(data,hv_mod)) %>% mutate(tidylms=map(lms,tidy)) %>% group_by(USING_DEPT_NO_DESC)  %>% do(augment(.$lms,newdata=.$data))
mods
mods<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS")) %>% group_by(USING_DEPT_NO_DESC) %>% nest() %>% mutate(lms=map(data,hv_mod)) %>% mutate(tidylms=map(lms,tidy)) %>% group_by(USING_DEPT_NO_DESC)  %>% do(augment(.$lms[[1]],newdata=.$data[[1]]))
mods
mods %>%  ggplot(aes(YEAR, mpg)) +
geom_point(shape = 1) +
geom_ribbon(aes(YEAR,
ymin = .fitted-1.96*.se.fit,
ymax = .fitted+1.96*.se.fit),
alpha = 0.5, fill = "black") +
geom_line(aes(Time, .fitted), size = 1, color = "red") +
facet_wrap(~USING_DEPT_NO_DESC)
mods %>%  ggplot(aes(YEAR, mpg)) +
geom_point(shape = 1) +
geom_ribbon(aes(YEAR,
ymin = .fitted-1.96*.se.fit,
ymax = .fitted+1.96*.se.fit),
alpha = 0.5, fill = "black") +
geom_line(aes(YEAR, .fitted), size = 1, color = "red") +
facet_wrap(~USING_DEPT_NO_DESC)
ggs<-mods %>%  ggplot(aes(YEAR, mpg)) +
geom_point(shape = 1) +
geom_ribbon(aes(YEAR,
ymin = .fitted-1.96*.se.fit,
ymax = .fitted+1.96*.se.fit),
alpha = 0.5, fill = "black") +
geom_line(aes(YEAR, .fitted), size = 1, color = "red") +
facet_wrap(~USING_DEPT_NO_DESC)
ggs
ggs<-mods %>%  ggplot(aes(YEAR, mpg)) +
geom_point(shape = 1) +
geom_ribbon(aes(YEAR,
ymin = .fitted-1.96*.se.fit,
ymax = .fitted+1.96*.se.fit),
alpha = 0.5, fill = "black") +
geom_line(aes(YEAR, .fitted), size = 1, color = "red") + scale_x_continuous("Year",breaks=seq(1990,2018,2)) +
facet_wrap(~USING_DEPT_NO_DESC)
ggs
mods
mods<-metc %>% filter(mpg>0,mpg<60, SEGMENT %in% c("Heavy"),USING_DEPT_NO_DESC %in% c("MT Non-Revenue","MT Revenue","MTS")) %>% group_by(USING_DEPT_NO_DESC) %>% nest() %>% mutate(lms=map(data,hv_mod)) %>% mutate(tidylms=map(lms,tidy))
mods2<-mods %>% group_by(USING_DEPT_NO_DESC)  %>% do(augment(.$lms[[1]],newdata=.$data[[1]]))
mods2
mods
mods$tidylms
mods
mods$tidylms
ggs<-mods2 %>%  ggplot(aes(YEAR, mpg)) +
geom_point(shape = 1,text=MODEL) +
geom_ribbon(aes(YEAR,
ymin = .fitted-1.96*.se.fit,
ymax = .fitted+1.96*.se.fit),
alpha = 0.5, fill = "black") +
geom_line(aes(YEAR, .fitted), size = 1, color = "red") + scale_x_continuous("Year",breaks=seq(1990,2018,2)) +
facet_wrap(~USING_DEPT_NO_DESC)
mods2$MODEL
ggs<-mods2 %>%  ggplot(aes(YEAR, mpg)) +
geom_point(shape = 1,text=MODEL) +
geom_ribbon(aes(YEAR,
ymin = .fitted-1.96*.se.fit,
ymax = .fitted+1.96*.se.fit),
alpha = 0.5, fill = "black") +
geom_line(aes(YEAR, .fitted), size = 1, color = "red") + scale_x_continuous("Year",breaks=seq(1990,2018,2)) +
facet_wrap(~USING_DEPT_NO_DESC)
ggs<-mods2 %>%  ggplot(aes(YEAR, mpg)) +
geom_point(shape = 1,aes(text=MODEL)) +
geom_ribbon(aes(YEAR,
ymin = .fitted-1.96*.se.fit,
ymax = .fitted+1.96*.se.fit),
alpha = 0.5, fill = "black") +
geom_line(aes(YEAR, .fitted), size = 1, color = "red") + scale_x_continuous("Year",breaks=seq(1990,2018,2)) +
facet_wrap(~USING_DEPT_NO_DESC)
ggs %>% ggplotly()
ggs<- ggs %>% ggplotly()
htmlwidgets::saveWidget(as_widget(ggs), "metcMPG.html")
ggs<-mods2 %>%  ggplot(aes(YEAR, mpg)) +
geom_point(shape = 1,aes(text=MODEL)) +
geom_ribbon(aes(YEAR,
ymin = .fitted-1.96*.se.fit,
ymax = .fitted+1.96*.se.fit),
alpha = 0.5, fill = "black") +
geom_line(aes(YEAR, .fitted), size = 1, color = "red") + scale_x_continuous("Year",breaks=seq(1990,2018,2)) +
facet_wrap(~USING_DEPT_NO_DESC) + theme(axis.text.x = element_text(angle=90))
ggs<- ggs %>% ggplotly()
ggs
htmlwidgets::saveWidget(as_widget(ggs), "metcMPG.html")
ggs<-mods2 %>%  ggplot(aes(as.factor(YEAR), mpg)) +
geom_point(shape = 1,aes(text=MODEL)) + geom_violin()
ggs<-mods2 %>%  ggplot(aes(as.factor(YEAR), mpg)) +
geom_point(shape = 1,aes(text=MODEL)) + geom_violin() +
#geom_ribbon(aes(YEAR,
#                 ymin = .fitted-1.96*.se.fit,
#                 ymax = .fitted+1.96*.se.fit),
#              alpha = 0.5, fill = "black") +
#  geom_line(aes(YEAR, .fitted), size = 1, color = "red") + scale_x_continuous("Year",breaks=seq(1990,2018,2)) +
facet_wrap(~USING_DEPT_NO_DESC) + theme(axis.text.x = element_text(angle=90))
ggs
ggs<-mods2 %>%  ggplot(aes(as.factor(YEAR), mpg)) +
geom_point(shape = 1,aes(text=MODEL)) + geom_violin() +
#geom_ribbon(aes(YEAR,
#                 ymin = .fitted-1.96*.se.fit,
#                 ymax = .fitted+1.96*.se.fit),
#              alpha = 0.5, fill = "black") +
#  geom_line(aes(YEAR, .fitted), size = 1, color = "red") + scale_x_continuous("Year",breaks=seq(1990,2018,2)) +
facet_wrap(~USING_DEPT_NO_DESC) + theme(axis.text.x = element_text(angle=90)) + scale_y_continuous(breaks=seq(0,12.5,1))
ggs
ggs<-mods2 %>%  ggplot(aes(as.factor(YEAR), mpg)) +
geom_point(shape = 1,aes(text=MODEL)) + geom_violin() + geom_boxplot(width=0.1)
ggs<-mods2 %>%  ggplot(aes(as.factor(YEAR), mpg)) +
geom_point(shape = 1,aes(text=MODEL)) + geom_violin() + geom_boxplot(width=0.1) +
#geom_ribbon(aes(YEAR,
#                 ymin = .fitted-1.96*.se.fit,
#                 ymax = .fitted+1.96*.se.fit),
#              alpha = 0.5, fill = "black") +
#  geom_line(aes(YEAR, .fitted), size = 1, color = "red") + scale_x_continuous("Year",breaks=seq(1990,2018,2)) +
facet_wrap(~USING_DEPT_NO_DESC) + theme(axis.text.x = element_text(angle=90)) + scale_y_continuous(breaks=seq(0,12.5,1))
ggs
ggs<-mods2 %>%  ggplot(aes(as.factor(YEAR), mpg)) +
geom_point(shape = 1,aes(text=MODEL)) + geom_violin() +  stat_summary(fun.y=median, geom="point", size=2, color="red")
ggs<-mods2 %>%  ggplot(aes(as.factor(YEAR), mpg)) +
geom_point(shape = 1,aes(text=MODEL)) + geom_violin() +  stat_summary(fun.y=median, geom="point", size=2, color="red") +
#geom_ribbon(aes(YEAR,
#                 ymin = .fitted-1.96*.se.fit,
#                 ymax = .fitted+1.96*.se.fit),
#              alpha = 0.5, fill = "black") +
#  geom_line(aes(YEAR, .fitted), size = 1, color = "red") + scale_x_continuous("Year",breaks=seq(1990,2018,2)) +
facet_wrap(~USING_DEPT_NO_DESC) + theme(axis.text.x = element_text(angle=90)) + scale_y_continuous(breaks=seq(0,12.5,1))
ggs
ggs<-mods2 %>%  ggplot(aes(as.factor(YEAR), mpg)) +
geom_point(shape = 1,aes(text=MODEL)) + geom_violin() +  stat_summary(fun.y=median, geom="point", size=1, color="red") +
#geom_ribbon(aes(YEAR,
#                 ymin = .fitted-1.96*.se.fit,
#                 ymax = .fitted+1.96*.se.fit),
#              alpha = 0.5, fill = "black") +
#  geom_line(aes(YEAR, .fitted), size = 1, color = "red") + scale_x_continuous("Year",breaks=seq(1990,2018,2)) +
facet_wrap(~USING_DEPT_NO_DESC) + theme(axis.text.x = element_text(angle=90)) + scale_y_continuous(breaks=seq(0,12.5,1))
ggs
sums<-data %>% group_by(VClass,year) %>% summarise_at(vars,mean,na.rm=T) %>% ggplot(aes(x=year,y=highway08U,color=VClass)) + geom_point() + scale_fill_Publication() +theme_Publication()
dat2
gg5
